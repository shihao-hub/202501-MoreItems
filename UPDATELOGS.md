# 更新日志

## version 6.0.5 (2026-01-25)

**本次更新新增了强san素食堡换人继承功能，并对神秘图腾进行了重大改进**

### 新增功能

1. 强san素食堡换人继承功能
   - 新增换人继承理智值功能
   - 可通过配置选项 `sanity_hamburger__inherit_when_change_character` 开启/关闭
   - 使用独立的持久化文件系统（按玩家ID存储）
   - 换人后自动继承之前保存的理智值数据

2. 神秘图腾重大改进（现改名"倾家荡产赌博机"）
   - 容器从1格升级为9格（3x3布局）
   - 支持每个格子存放堆叠物品
   - 实现批量赌博功能：对每个格子分别进行赌博
   - 每个格子55%概率翻倍，45%概率消失
   - 添加详细的赌博日志输出，便于查看结果

### Bug 修复

3. 修复强san素食堡换人继承功能无法启用的bug
   - 添加了缺失的配置选项定义
   - 在 modinfo.lua 和 modtuning.lua 中添加了配置绑定

4. 修复神秘图腾翻倍逻辑
   - 修复赌博成功时只掉落副本，原物品被删除的bug
   - 正确实现翻倍效果：原物品掉落 + 创建副本掉落 = 2个物品

### 优化改进

5. 优化日志输出
   - 优化倾家荡产赌博机日志，添加详细的赌博结果统计（翻倍物品清单、损失物品清单）
   - 优化换人继承日志输出，删除冗余日志，只在换人时输出有意义的信息
   - 新日志格式包含：玩家ID、角色名称、属性变化值

---

## version 6.0.4 (2026-01-24)

**本次更新主要完善了跨服数据同步系统，并新增了强san素食堡功能**

### 新增功能

1. 新增物品：强san素食堡
   - 参考暖胃汉堡包实现，永久增加理智值上限的食物
   - 使用相同的配方（5个腐烂食物）和视觉效果
   - 支持跨服务器同步（主服务器/洞穴）
   - 限制在特定角色列表中使用

2. 暖胃汉堡包换人继承功能
   - 新增换人继承饥饿度功能
   - 可通过配置选项 `stomach_warming_hamburger__inherit_when_change_character` 开启/关闭
   - 使用独立的持久化文件系统（按玩家ID存储）
   - 换人后自动继承之前保存的饥饿度数据

### 重要修复

3. 跨服数据同步系统重构
   - 实现了完整的跨服务器数据同步机制（洞穴 ↔ 地面）
   - 修复了洞穴中吃食物后数据不同步到地面的问题
   - 修复了跨服后数据丢失的持久化问题
   - 优化了数据流：洞穴吃食物 → RPC 同步 → 主服务器存储

4. 数据存储优化
   - 统一在主服务器存储数据，避免上下洞分离
   - 修复了洞穴服务器因文件名为 nil 导致的崩溃
   - RPC 接收时直接更新玩家文件，确保数据实时同步
   - 添加了文件写入验证机制

5. Bug 修复
   - 修复了未吃汉堡/强心素食堡也会继承的 bug
   - 修复了继承逻辑中未使用世界组件最新数据的问题
   - 修复了 Shard RPC 参数传递错误
   - 修复了格罗姆奶昔不能对格罗姆使用的 bug

### 技术改进

6. 新增 `mone_shard_sync` 世界组件，统一管理跨服数据
7. 新增 `scripts/moreitems/lib/shard/sync_rpc.lua` RPC 调用辅助库
8. 优化了组件文件结构，符合 DST 组件系统规范
9. 添加了详细的调试日志用于问题诊断
10. 移除了装备柜的换装功能，避免点击冲突

---

## version 6.0.0

1. 修复了 2025-11-04 永不妥协导致的材料袋极度异常的 bug
2. 修复了豪华系列弹性升级后，名字的前缀特别长的 bug 
3. 现在贮藏箱和熊皮保鲜柜也支持弹性升级了
4. 升级版·耕地机贴图消失问题修复
5. 超级牛铃新增重生护符复活牛的功能（但是牛死了不复活直接下线再上线会消失...）
6. 新增物品：升级版·挖洞兔角号，就是原版挖洞兔号角无耐久
7. 新增物品：食人花宝箱，支持弹性升级，它会定期收集周围食人花吞噬的物品
8. 蜜汁大肉棒内容修改，新增功能：击杀Boss的时候有 20% 概率触发双倍掉落效果
9. 皮痒傀儡现在可以秒杀青蛙、月后青蛙、蜘蛛女王 
10. 单身狗现在可以秒杀水晶冠秃鹫（至于为什么，这个物品本来就是为了造狗王工厂...）
11. 新增物品：升级版·猪鼻铸币，原版猪鼻铸币的加强版。
12. 焚化炉重制为腐化箱，放入其中的有新鲜度的物品会慢慢腐烂
